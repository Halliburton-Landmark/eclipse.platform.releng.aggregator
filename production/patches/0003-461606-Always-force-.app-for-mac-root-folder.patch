From 237af4ef4a06c78dd177e1cdb0c0a624d7cfdd89 Mon Sep 17 00:00:00 2001
From: Pascal Rapicault <pascal@rapicorp.com>
Date: Fri, 6 Mar 2015 11:47:10 -0500
Subject: [PATCH 3/4] 461606 - Always force .app for mac root folder

Bug 461606

Signed-off-by: Pascal Rapicault <pascal@rapicorp.com>
Change-Id: I0a0d42859a7d1a07f686a29de808f186cf81f2f5
---
 .../org/eclipse/tycho/plugins/p2/director/Product.java   | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/tycho-p2/tycho-p2-director-plugin/src/main/java/org/eclipse/tycho/plugins/p2/director/Product.java b/tycho-p2/tycho-p2-director-plugin/src/main/java/org/eclipse/tycho/plugins/p2/director/Product.java
index 11cb02d..457763f 100644
--- a/tycho-p2/tycho-p2-director-plugin/src/main/java/org/eclipse/tycho/plugins/p2/director/Product.java
+++ b/tycho-p2/tycho-p2-director-plugin/src/main/java/org/eclipse/tycho/plugins/p2/director/Product.java
@@ -15,6 +15,7 @@ import java.util.Collections;
 import java.util.List;
 import java.util.Map;
 
+import org.eclipse.osgi.service.environment.Constants;
 import org.eclipse.tycho.core.resolver.shared.DependencySeed;
 
 /**
@@ -79,6 +80,8 @@ public final class Product {
     }
 
     public String getRootFolder(String os) {
+        if (Constants.OS_MACOSX.equals(os))
+            return getRootFolderMac();
         if (rootFolders == null) {
             return rootFolder;
         } else {
@@ -90,6 +93,19 @@ public final class Product {
         }
     }
 
+    private String getRootFolderMac() {
+        if (rootFolders == null)
+            return "Eclipse.app";
+
+        String folder = null;
+        if (rootFolders.get(Constants.OS_MACOSX) == null) {
+            folder = rootFolder;
+        } else {
+            folder = rootFolders.get(Constants.OS_MACOSX);
+        }
+        return folder.endsWith(".app") ? folder : folder + ".app";
+    }
+
     public String getArchiveFileName() {
         return archiveFileName;
     }
-- 
1.9.1

